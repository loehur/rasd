const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/api-K6p-leZq.js","assets/api-rG_fphBW.js"])))=>i.map(i=>d[i]);
import{r as _,i as $,j as C,c as i,o as d,p as N,a as e,d as g,t as p,w as R,e as S,v as A,F as E,l as P,n as j,h as I}from"./tailwind-DNrR0bkN.js";import{A as w}from"./api-rG_fphBW.js";import{_ as O}from"./AdminHeader-KbfMcPGE.js";const T="modulepreload",B=function(v){return"/jobs/sd_pro/public/"+v},U={},D=function(c,f,h){let x=Promise.resolve();if(f&&f.length>0){let y=function(l){return Promise.all(l.map(m=>Promise.resolve(m).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),a=u?.nonce||u?.getAttribute("nonce");x=y(f.map(l=>{if(l=B(l),l in U)return;U[l]=!0;const m=l.endsWith(".css"),o=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${o}`))return;const s=document.createElement("link");if(s.rel=m?"stylesheet":T,m||(s.as="script"),s.crossOrigin="",s.href=l,a&&s.setAttribute("nonce",a),document.head.appendChild(s),m)return new Promise((r,t)=>{s.addEventListener("load",r),s.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${l}`)))})}))}function b(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return x.then(u=>{for(const a of u||[])a.status==="rejected"&&b(a.reason);return c().catch(b)})},L={class:"min-h-screen bg-slate-950 text-slate-100"},M={class:"px-3 sm:px-6 lg:px-8 py-4"},V={class:"max-w-4xl mx-auto space-y-6"},z={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6"},J={class:"flex items-center justify-between mb-4"},q={class:"text-xs px-2 py-1 rounded bg-slate-800/60 border border-slate-700"},F={key:0,class:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl text-yellow-400"},X={key:1},G={class:"sm:col-span-2 flex justify-end"},H=["disabled"],W={class:"overflow-x-auto -mx-3 sm:mx-0 hidden md:block"},K={class:"min-w-full text-sm"},Q={class:"py-2 break-words px-3 sm:px-0"},Y={class:"py-2 break-words px-3 sm:px-0"},Z={class:"py-2"},ee={class:"py-2 flex items-center gap-2"},te=["onClick"],se=["onClick"],re={class:"md:hidden space-y-3"},oe={class:"flex items-center justify-between"},ae={class:"text-sm font-semibold text-slate-100"},le={class:"text-xs text-slate-400"},ne={class:"text-xs px-2 py-1 rounded bg-slate-700 text-slate-300"},ie={class:"mt-3 flex gap-2"},de=["onClick"],ce=["onClick"],ue={class:"text-white"},me={__name:"UsersPage",setup(v){const c=_({role:""}),f=_([]),h=_({name:"",phone_number:""}),x=_(!1),b=_({show:!1,message:"",type:"success"}),u=$(()=>f.value.filter(s=>!(s.role==="super-admin"||s.id===c.value.id)));C(async()=>{const s=localStorage.getItem("user");if(!s){window.location.href="/admin";return}c.value=JSON.parse(s),await a()});const a=async()=>{try{const s=localStorage.getItem("auth_token"),r=JSON.parse(localStorage.getItem("user")||"{}").role,n=await(await fetch(`${w}/api/users`,{method:"GET",headers:{Authorization:`Bearer ${s}`,"X-Role":r}})).json();n.success&&(f.value=n.data)}catch(s){console.error("Load users error:",s)}},y=async()=>{x.value=!0;try{const s=localStorage.getItem("auth_token"),r=JSON.parse(localStorage.getItem("user")||"{}").role,n=await(await fetch(`${w}/api/users`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json","X-Role":r},body:JSON.stringify({name:h.value.name,phone_number:h.value.phone_number})})).json();n.success?(o("Admin user created"),h.value={name:"",phone_number:""},await a()):o(n.message||"Failed to create","error")}catch{o("Error creating user","error")}finally{x.value=!1}},l=async s=>{try{const r=localStorage.getItem("auth_token"),t=JSON.parse(localStorage.getItem("user")||"{}").role,k=await(await fetch(`${w}/api/users/${s}/reset-password`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"X-Role":t}})).json();k.success?o('Password reset to "Admin123!"'):o(k.message||"Reset failed","error")}catch{o("Error resetting password","error")}},m=async s=>{try{if(c.value.role!=="super-admin"){o("Forbidden","error");return}const{deleteUser:r}=await D(async()=>{const{deleteUser:n}=await import("./api-K6p-leZq.js");return{deleteUser:n}},__vite__mapDeps([0,1])),t=await r(s);t.success?(o("User deleted"),await a()):o(t.message||"Delete failed","error")}catch{o("Error deleting user","error")}},o=(s,r="success")=>{b.value={show:!0,message:s,type:r},setTimeout(()=>{b.value.show=!1},3e3)};return(s,r)=>(d(),i("div",L,[N(O,{title:"Manage Users",subtitle:"Admin Portal"}),e("main",M,[e("div",V,[e("div",z,[e("div",J,[r[2]||(r[2]=e("h2",{class:"text-xl font-bold"},"Manage Users",-1)),e("span",q,"Role: "+p(c.value.role),1)]),c.value.role!=="super-admin"?(d(),i("div",F," Hanya super-admin yang dapat mengakses halaman Users. ")):(d(),i("div",X,[e("form",{onSubmit:R(y,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6"},[e("div",null,[r[3]||(r[3]=e("label",{class:"block text-sm text-slate-300 mb-2"},"Name *",-1)),S(e("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>h.value.name=t),type:"text",required:"",class:"w-full px-3 sm:px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg"},null,512),[[A,h.value.name]])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block text-sm text-slate-300 mb-2"},"Phone Number *",-1)),S(e("input",{"onUpdate:modelValue":r[1]||(r[1]=t=>h.value.phone_number=t),type:"text",required:"",class:"w-full px-3 sm:px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg"},null,512),[[A,h.value.phone_number]])]),e("div",G,[e("button",{disabled:x.value,class:"w-full sm:w-auto px-5 sm:px-6 py-2 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-white disabled:opacity-50"},p(x.value?"Saving...":"Add Admin"),9,H)])],32),e("div",W,[e("table",K,[r[5]||(r[5]=e("thead",null,[e("tr",{class:"text-left text-slate-300 border-b border-slate-800"},[e("th",{class:"py-2 px-3 sm:px-0"},"Name"),e("th",{class:"py-2 px-3 sm:px-0"},"Phone"),e("th",{class:"py-2"},"Role"),e("th",{class:"py-2"},"Actions")])],-1)),e("tbody",null,[(d(!0),i(E,null,P(u.value,t=>(d(),i("tr",{key:t.id,class:"border-b border-slate-800"},[e("td",Q,p(t.name),1),e("td",Y,p(t.phone_number),1),e("td",Z,p(t.role),1),e("td",ee,[t.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:0,onClick:n=>l(t.id),class:"w-full sm:w-auto px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 rounded text-white"}," Reset ",8,te)):g("",!0),t.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:1,onClick:n=>m(t.id),class:"w-full sm:w-auto px-3 py-1 text-sm bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,se)):g("",!0)])]))),128))])])]),e("div",re,[(d(!0),i(E,null,P(u.value,t=>(d(),i("div",{key:t.id,class:"p-4 bg-slate-800/50 border border-slate-700 rounded-xl"},[e("div",oe,[e("div",null,[e("p",ae,p(t.name),1),e("p",le,p(t.phone_number),1)]),e("span",ne,p(t.role),1)]),e("div",ie,[t.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:0,onClick:n=>l(t.id),class:"flex-1 px-3 py-2 text-xs bg-blue-600 hover:bg-blue-700 rounded text-white"}," Reset ",8,de)):g("",!0),t.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:1,onClick:n=>m(t.id),class:"flex-1 px-3 py-2 text-xs bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,ce)):g("",!0)])]))),128))])]))]),b.value.show?(d(),i("div",{key:0,class:j(["fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 px-4 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg z-50",b.value.type==="success"?"bg-green-600":"bg-red-600"])},[e("span",ue,p(b.value.message),1)],2)):g("",!0)])])]))}};I(me).mount("#app");
