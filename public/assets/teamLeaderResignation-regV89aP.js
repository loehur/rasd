import{r as d,i as M,j as oe,c as r,o as n,a as e,d as $,g as j,n as C,t as l,F as A,l as V,w as ae,e as v,k as L,v as z,b as re,h as ne}from"./tailwind-XrDIfzaI.js";import{A as P}from"./api-n_PshMHp.js";const le={class:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-red-50 p-6"},ie={class:"max-w-7xl mx-auto"},de={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ue={class:"p-6"},pe={class:"bg-white shadow-sm border border-gray-200 rounded-xl p-4 mb-4"},ce={class:"flex flex-wrap gap-2"},ge={class:"ml-1 text-xs opacity-70"},me=["onClick"],fe={class:"ml-1 text-xs opacity-70"},ye={key:0,class:"text-center py-12"},ve={key:1,class:"text-center py-12"},xe={class:"text-gray-600"},be={key:2,class:"overflow-x-auto"},he={class:"min-w-full divide-y divide-gray-200"},we={class:"bg-white divide-y divide-gray-200"},_e={class:"px-6 py-4 whitespace-nowrap"},ke={class:"text-sm font-medium text-gray-900"},Se={class:"text-xs text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},je={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},De=["title"],Be={class:"mt-6 flex items-center justify-between"},Fe={class:"text-sm text-gray-600"},Ae={key:3,class:"text-center py-12"},Ve={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto"},Le={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full my-8"},ze={class:"p-6"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Te=["value"],Ee={class:"mt-4 space-y-4"},Ie={class:"text-xs text-gray-500 mt-1"},Ue={key:0,class:"flex items-center justify-center w-full"},Ne={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition"},Ye={key:1,class:"relative"},$e=["src"],qe={class:"flex gap-3 pt-6"},Oe=["disabled"],Ge={class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},He={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},Je={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},We={__name:"ResignationApp",setup(Ke){const x=d([]),_=d([]),R=d(!0),b=d(""),D=d(!1),k=d(!1),c=d({show:!1,message:"",type:"success"}),p=d(new Date().getFullYear()),T=d({total:0,per_page:15,current_page:1,last_page:1,from:0,to:0}),a=d({staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null}),g=d(null),q=M(()=>_.value.filter(o=>o.staff_status==="active"));oe(()=>{E(),I()});const E=async(o=1)=>{R.value=!0,b.value="";try{const t=localStorage.getItem("tl_auth_token"),s=new URLSearchParams;s.set("page",String(o));const u=await(await fetch(`${P}/api/resignations?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json();u.success?(x.value=u.data||[],T.value=u.pagination):b.value=u.message||"Failed to load resignations"}catch(t){b.value="Failed to load resignations",console.error("Error:",t)}finally{R.value=!1}},I=async()=>{try{const o=localStorage.getItem("tl_auth_token"),s=await(await fetch(`${P}/api/attendances/staff/team-leader`,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}})).json();s.success&&(_.value=s.data||[])}catch(o){console.error("Error fetching staff:",o)}},O=()=>{_.value.find(o=>o.staff_id===a.value.staff_id)},G=async o=>{const t=o.target.files[0];if(!t){a.value.proof=null,g.value=null;return}if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){h("Please upload only JPG or PNG images","error"),o.target.value="";return}try{const s=await H(t);a.value.proof=s;const i=new FileReader;i.onload=u=>{g.value=u.target.result},i.readAsDataURL(s)}catch(s){console.error("Error compressing image:",s),h("Failed to process image","error")}},H=async o=>new Promise((t,s)=>{const i=new FileReader;i.readAsDataURL(o),i.onload=u=>{const m=new Image;m.src=u.target.result,m.onload=()=>{const S=document.createElement("canvas");let f=m.width,y=m.height;if(f>1920||y>1920){const w=Math.min(1920/f,1920/y);f=Math.floor(f*w),y=Math.floor(y*w)}S.width=f,S.height=y,S.getContext("2d").drawImage(m,0,0,f,y);let F=.85;const Y=()=>{S.toBlob(w=>{if(w.size>2e5&&F>.1)F-=.05,Y();else{const se=new File([w],o.name,{type:"image/jpeg",lastModified:Date.now()});t(se)}},"image/jpeg",F)};Y()},m.onerror=s},i.onerror=s}),J=()=>{a.value.proof=null,g.value=null},W=()=>{D.value=!0},U=()=>{D.value=!1,K()},K=()=>{a.value={staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null},g.value=null},X=async()=>{k.value=!0;try{const o=localStorage.getItem("tl_auth_token"),t=new FormData;t.append("staff_id",a.value.staff_id),t.append("last_working_day",a.value.last_working_day),t.append("resignation_type",a.value.resignation_type),t.append("resignation_subtype",a.value.resignation_subtype),t.append("report_day",a.value.report_day),t.append("reason",a.value.reason),a.value.proof&&t.append("proof",a.value.proof);const i=await(await fetch(`${P}/api/resignations`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:t})).json();i.success?(h(i.message||"Resignation recorded successfully","success"),U(),E(T.value.current_page),I()):h(i.message||"Operation failed","error")}catch(o){h("An error occurred: "+o.message,"error"),console.error("Error:",o)}finally{k.value=!1}},h=(o,t="success")=>{c.value={show:!0,message:o,type:t},setTimeout(()=>{c.value.show=!1},3e3)},N=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",Q=M(()=>{const o=new Set;return x.value.forEach(t=>{const s=t.report_day||t.last_working_day;if(!s)return;const i=new Date(s).getFullYear();isNaN(i)||o.add(i)}),Array.from(o).sort((t,s)=>s-t)}),Z=o=>x.value.filter(t=>{const s=t.report_day||t.last_working_day;return s&&new Date(s).getFullYear()===o}).length,ee=M(()=>new Set(_.value.map(o=>o.staff_id))),B=M(()=>x.value.filter(o=>{if(!ee.value.has(o.staff_id))return!1;if(!p.value||p.value==="")return!0;const t=o.report_day||o.last_working_day;return t?new Date(t).getFullYear()===p.value:!1})),te=()=>{window.location.href="/team-leader/dashboard"};return(o,t)=>(n(),r("div",le,[e("div",ie,[e("div",{class:"mb-8"},[e("button",{onClick:te,class:"mb-4 text-red-600 hover:text-red-800 flex items-center gap-2 transition"},[...t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),j(" Back to Dashboard ",-1)])]),t[8]||(t[8]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-red-600 via-orange-600 to-red-700"}," Staff Resignation ")])],-1))]),e("div",{class:"mb-6"},[e("button",{onClick:W,class:"px-6 py-3 bg-gradient-to-r from-red-600 to-orange-600 text-white font-semibold rounded-lg hover:from-red-700 hover:to-orange-700"},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5 inline-block mr-2 -mt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Add Resignation Record ",-1)])])]),e("div",de,[t[17]||(t[17]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h2",{class:"text-xl font-bold text-gray-900"}," All Resignation Records ")],-1)),e("div",ue,[e("div",pe,[t[11]||(t[11]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),e("span",{class:"text-sm font-medium text-gray-700"},"Filter by Year:")],-1)),e("div",ce,[e("button",{onClick:t[0]||(t[0]=s=>p.value=""),class:C(["px-4 py-2 text-sm font-medium rounded-lg transition",p.value===""?"bg-gray-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[t[10]||(t[10]=j(" All Years ",-1)),e("span",ge,"("+l(x.value.length)+")",1)],2),(n(!0),r(A,null,V(Q.value,s=>(n(),r("button",{key:s,onClick:i=>p.value=s,class:C(["px-4 py-2 text-sm font-medium rounded-lg transition",p.value===s?"bg-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[j(l(s)+" ",1),e("span",fe,"("+l(Z(s))+")",1)],10,me))),128))])]),R.value?(n(),r("div",ye,[...t[12]||(t[12]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"},null,-1),e("p",{class:"mt-4 text-gray-600"}," Loading resignation records... ",-1)])])):b.value?(n(),r("div",ve,[t[13]||(t[13]=e("svg",{class:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",xe,l(b.value),1)])):B.value.length>0?(n(),r("div",be,[e("table",he,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Employee "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Last Working Day "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Type "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Subtype "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Report Day "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Reason "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Status ")])],-1)),e("tbody",we,[(n(!0),r(A,null,V(B.value,s=>(n(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",_e,[e("div",ke,l(s.staff_name),1),e("div",Se,l(s.staff_id),1)]),e("td",Me,l(N(s.last_working_day)),1),e("td",je,[e("span",{class:C(["px-2 py-1 text-xs font-semibold rounded-full",s.resignation_type==="voluntary"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"])},l(s.resignation_type),3)]),e("td",Ce,l(s.resignation_subtype),1),e("td",Re,l(N(s.report_day)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate",title:s.reason},l(s.reason||"-"),9,De),t[14]||(t[14]=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"}," Inactive ")],-1))]))),128))])]),e("div",Be,[e("p",Fe," Showing "+l(B.value.length)+" results ",1)])])):(n(),r("div",Ae,[...t[16]||(t[16]=[e("svg",{class:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-gray-600"}," No resignation records found ",-1)])]))])])]),D.value?(n(),r("div",Ve,[e("div",Le,[t[30]||(t[30]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h3",{class:"text-xl font-bold text-gray-900"}," Record Resignation ")],-1)),e("div",ze,[e("form",{onSubmit:ae(X,["prevent"])},[e("div",Pe,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Employee *",-1)),v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.staff_id=s),onChange:O,required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[t[18]||(t[18]=e("option",{value:""},"Select Employee",-1)),(n(!0),r(A,null,V(q.value,s=>(n(),r("option",{key:s.staff_id,value:s.staff_id},l(s.staff_id)+" - "+l(s.name),9,Te))),128))],544),[[L,a.value.staff_id]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Last Working Day *",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.last_working_day=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[z,a.value.last_working_day]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type *",-1)),v(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.resignation_type=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[21]||(t[21]=[e("option",{value:""},"Select Type",-1),e("option",{value:"voluntary"},"Voluntary",-1),e("option",{value:"involuntary"}," Involuntary ",-1)])],512),[[L,a.value.resignation_type]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Subtype *",-1)),v(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.resignation_subtype=s),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[23]||(t[23]=[e("option",{value:""},"Select Subtype",-1),e("option",{value:"personal_reason"}," Personal Reason ",-1),e("option",{value:"management_reason"}," Management Reason ",-1)])],512),[[L,a.value.resignation_subtype]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Report Day *",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.report_day=s),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[z,a.value.report_day]])])]),e("div",Ee,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reason *",-1)),v(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.reason=s),required:"",rows:"3",maxlength:"1000",placeholder:"Enter resignation reason...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 resize-none"},null,512),[[z,a.value.reason]]),e("p",Ie,l(a.value.reason.length)+"/1000 characters ",1)]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Proof (Optional)",-1)),g.value?(n(),r("div",Ye,[e("img",{src:g.value,class:"w-full h-48 object-cover rounded-lg border border-gray-300"},null,8,$e),e("button",{type:"button",onClick:J,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-2 hover:bg-red-700 transition"},[...t[28]||(t[28]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(n(),r("div",Ue,[e("label",Ne,[t[27]||(t[27]=re('<div class="flex flex-col items-center justify-center pt-5 pb-6"><svg class="w-8 h-8 mb-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><p class="mb-1 text-sm text-gray-500"><span class="font-semibold">Click to upload</span></p><p class="text-xs text-gray-500"> PNG or JPG (MAX. 10MB, will be compressed to 200KB) </p></div>',1)),e("input",{type:"file",class:"hidden",onChange:G,accept:"image/jpeg,image/jpg,image/png"},null,32)])]))])]),e("div",qe,[e("button",{type:"button",onClick:U,class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{type:"submit",disabled:k.value,class:"flex-1 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition"},l(k.value?"Submitting...":"Submit"),9,Oe)])],32)])])])):$("",!0),c.value.show?(n(),r("div",{key:1,class:C(["fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3",c.value.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"])},[(n(),r("svg",Ge,[c.value.type==="success"?(n(),r("path",He)):(n(),r("path",Je))])),e("span",null,l(c.value.message),1)],2)):$("",!0)]))}};ne(We).mount("#app");
