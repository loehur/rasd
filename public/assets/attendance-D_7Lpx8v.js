import{r as h,j as F,c as r,o as l,p as P,a as e,d as U,e as j,v as B,F as N,l as M,t as n,n as D,h as W}from"./tailwind--56Su58R.js";import{_ as H}from"./AdminHeader-Dpsy_2sA.js";import{adminGetAttendancesByMonth as O,adminDeleteAttendance as V}from"./api-K6p-leZq.js";import{A as z}from"./api-rG_fphBW.js";const I={class:"min-h-screen bg-slate-950 text-slate-100"},T={class:"px-3 sm:px-6 lg:px-8 py-4"},G={class:"max-w-6xl mx-auto space-y-6"},Y={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6"},q={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"},J={class:"flex items-center gap-3"},K={key:0,class:"p-6 text-slate-300"},Q={key:1},X={class:"overflow-x-auto -mx-3 sm:mx-0"},Z={class:"min-w-full text-sm"},ee={class:"py-2 px-3 sm:px-0"},te={class:"font-medium text-slate-100"},se={class:"text-xs text-slate-400"},oe={class:"py-2"},ae={class:"py-2"},ne={class:"py-2"},re={class:"py-2"},le={class:"py-2"},ce={class:"py-2"},de={class:"py-2"},ie=["onClick"],pe={class:"text-white"},me={__name:"AttendancePage",setup(ue){const x=h(!1),y=h([]),u=h(`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`),c=h({show:!1,message:"",type:"success"});F(async()=>{await b()});const b=async()=>{try{x.value=!0;const a=await O(u.value,1e3);a.success?y.value=a.data||[]:d(a.message||"Failed to load attendances","error")}catch{d("Error loading attendances","error")}finally{x.value=!1}},k=async a=>{try{const s=await V(a);s.success?(d("Attendance deleted"),await b()):d(s.message||"Delete failed","error")}catch{d("Error deleting attendance","error")}},S=a=>new Date(a).toLocaleDateString(),d=(a,s="success")=>{c.value={show:!0,message:a,type:s},setTimeout(()=>{c.value.show=!1},3e3)},A=()=>{const s=[["SN","Status","WFH/Oniste","ID Staff","Name Staff","Position","Superior","Department","Hiredate","Rank","Device","Report Date","Ranking Intervals","Group","Reason for resign","Proof"],...y.value.map((t,p)=>{const m=t.proof||"",L=window.location.origin,_=String(z).replace(/\/$/,""),$=/^https?:\/\//i.test(_)?_:`${L}${_.startsWith("/")?"":"/"}${_}`,v=m.startsWith("/")?m.slice(1):m,C=/^https?:\/\//i.test(m)?m:v?`${$}/${v}`:"",w=t.team_leader||t.teamLeader,E=t.superior||w&&w.name||"";return[p+1,t.status_code||"",t.work_status||"",t.staff_id||"",t.name||"",t.position||"",E,t.department||"",t.hire_date?new Date(t.hire_date).toLocaleDateString():"",t.rank||"",t.device||"",t.report_day?new Date(t.report_day).toLocaleDateString():"",t.ranking_intervals||"",t.group||"",t.reason_for_resign||"",C]})],o=t=>{const p=String(t??"");return/[",\n]/.test(p)?'"'+p.replace(/"/g,'""')+'"':p},g=s.map(t=>t.map(o).join(",")).join(`
`),R=new Blob([g],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(R),i=document.createElement("a");i.href=f,i.download=`attendance_${u.value}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(f)};return(a,s)=>(l(),r("div",I,[P(H,{title:"Attendance Records",subtitle:"Admin Portal"}),e("main",T,[e("div",G,[e("div",Y,[e("div",q,[s[2]||(s[2]=e("h2",{class:"text-lg sm:text-xl font-bold"}," Attendance Records ",-1)),e("div",J,[s[1]||(s[1]=e("label",{class:"text-sm text-slate-300"},"Filter bulan:",-1)),j(e("input",{type:"month","onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),onChange:b,class:"px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-slate-100"},null,544),[[B,u.value]]),e("button",{onClick:A,class:"px-3 py-2 bg-emerald-600 hover:bg-emerald-700 rounded text-white"}," Export ")])]),x.value?(l(),r("div",K," Loading... ")):(l(),r("div",Q,[e("div",X,[e("table",Z,[s[3]||(s[3]=e("thead",null,[e("tr",{class:"text-left text-slate-300 border-b border-slate-800"},[e("th",{class:"py-2 px-3 sm:px-0"}," Employee "),e("th",{class:"py-2"},"Position"),e("th",{class:"py-2"},"Department"),e("th",{class:"py-2"},"WFH/Onsite"),e("th",{class:"py-2"},"Device"),e("th",{class:"py-2"},"Report Day"),e("th",{class:"py-2"},"Status"),e("th",{class:"py-2"},"Actions")])],-1)),e("tbody",null,[(l(!0),r(N,null,M(y.value,o=>(l(),r("tr",{key:o.id,class:"border-b border-slate-800"},[e("td",ee,[e("div",te,n(o.name),1),e("div",se,n(o.staff_id),1)]),e("td",oe,n(o.position),1),e("td",ae,n(o.department),1),e("td",ne,[e("span",{class:D(["px-2 py-1 text-xs rounded-full border",o.work_status==="WFH"?"bg-blue-500/10 text-blue-300 border-blue-500/30":"bg-emerald-500/10 text-emerald-300 border-emerald-500/30"])},n(o.work_status),3)]),e("td",re,n(o.device),1),e("td",le,n(S(o.report_day)),1),e("td",ce,n(o.status_code),1),e("td",de,[e("button",{onClick:g=>k(o.id),class:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,ie)])]))),128))])])])]))]),c.value.show?(l(),r("div",{key:0,class:D(["fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 px-4 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg z-50",c.value.type==="success"?"bg-green-600":"bg-red-600"])},[e("span",pe,n(c.value.message),1)],2)):U("",!0)])])]))}};W(me).mount("#app");
