import{r as h,j as L,c as r,o as l,a as e,d as B,g as E,e as F,v as j,F as U,l as $,t as n,n as f,h as M}from"./tailwind-Bes4KR6F.js";import{adminGetAttendancesByMonth as N,adminDeleteAttendance as P}from"./api-Cer3rv52.js";import{A as H}from"./api-n_PshMHp.js";const O={class:"min-h-screen bg-slate-950 text-slate-100"},T={class:"px-3 sm:px-6 lg:px-8 py-4"},V={class:"max-w-6xl mx-auto space-y-6"},W={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6"},z={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"},I={class:"flex items-center gap-3"},G={key:0,class:"p-6 text-slate-300"},Y={key:1},q={class:"overflow-x-auto -mx-3 sm:mx-0"},J={class:"min-w-full text-sm"},K={class:"py-2 px-3 sm:px-0"},Q={class:"font-medium text-slate-100"},X={class:"text-xs text-slate-400"},Z={class:"py-2"},ee={class:"py-2"},te={class:"py-2"},se={class:"py-2"},oe={class:"py-2"},ae={class:"py-2"},ne={class:"py-2"},re=["onClick"],le={class:"text-white"},de={__name:"AttendancePage",setup(ce){const x=h(!1),_=h([]),m=h(`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`),d=h({show:!1,message:"",type:"success"});L(async()=>{await b()});const b=async()=>{try{x.value=!0;const a=await N(m.value,1e3);a.success?_.value=a.data||[]:c(a.message||"Failed to load attendances","error")}catch{c("Error loading attendances","error")}finally{x.value=!1}},w=async a=>{try{const s=await P(a);s.success?(c("Attendance deleted"),await b()):c(s.message||"Delete failed","error")}catch{c("Error deleting attendance","error")}},k=a=>new Date(a).toLocaleDateString(),c=(a,s="success")=>{d.value={show:!0,message:a,type:s},setTimeout(()=>{d.value.show=!1},3e3)},D=()=>{window.location.href="/admin/dashboard"},S=()=>{const s=[["SN","Status","WFH/Oniste","ID Staff","Name Staff","Position","Superior","Department","Hiredate","Rank","Device","Report  Date","Ranking Intervals","Group","Reason for resign","Proof"],..._.value.map((t,p)=>{const u=t.proof||"",R=String(H||"").replace(/\/$/,""),y=u.startsWith("/")?u.slice(1):u,C=/^https?:\/\//i.test(u)?u:y?`${R}/${y}`:"";return[p+1,t.status_code||"",t.work_status||"",t.staff_id||"",t.name||"",t.position||"",t.superior||"",t.department||"",t.hire_date?new Date(t.hire_date).toLocaleDateString():"",t.rank||"",t.device||"",t.report_day?new Date(t.report_day).toLocaleDateString():"",t.ranking_intervals||"",t.group||"",t.reason_for_resign||"",C]})],o=t=>{const p=String(t??"");return/[",\n]/.test(p)?'"'+p.replace(/"/g,'""')+'"':p},v=s.map(t=>t.map(o).join(",")).join(`
`),A=new Blob([v],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(A),i=document.createElement("a");i.href=g,i.download=`attendance_${m.value}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(g)};return(a,s)=>(l(),r("div",O,[e("main",T,[e("div",V,[e("div",{class:"mb-4"},[e("button",{onClick:D,class:"text-slate-400 hover:text-slate-200 flex items-center gap-2 transition"},[...s[1]||(s[1]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),E(" Back to Dashboard ",-1)])])]),e("div",W,[e("div",z,[s[3]||(s[3]=e("h2",{class:"text-lg sm:text-xl font-bold"}," Attendance Records ",-1)),e("div",I,[s[2]||(s[2]=e("label",{class:"text-sm text-slate-300"},"Filter bulan:",-1)),F(e("input",{type:"month","onUpdate:modelValue":s[0]||(s[0]=o=>m.value=o),onChange:b,class:"px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-slate-100"},null,544),[[j,m.value]]),e("button",{onClick:S,class:"px-3 py-2 bg-emerald-600 hover:bg-emerald-700 rounded text-white"}," Export ")])]),x.value?(l(),r("div",G," Loading... ")):(l(),r("div",Y,[e("div",q,[e("table",J,[s[4]||(s[4]=e("thead",null,[e("tr",{class:"text-left text-slate-300 border-b border-slate-800"},[e("th",{class:"py-2 px-3 sm:px-0"}," Employee "),e("th",{class:"py-2"},"Position"),e("th",{class:"py-2"},"Department"),e("th",{class:"py-2"},"WFH/Onsite"),e("th",{class:"py-2"},"Device"),e("th",{class:"py-2"},"Report Day"),e("th",{class:"py-2"},"Status"),e("th",{class:"py-2"},"Actions")])],-1)),e("tbody",null,[(l(!0),r(U,null,$(_.value,o=>(l(),r("tr",{key:o.id,class:"border-b border-slate-800"},[e("td",K,[e("div",Q,n(o.name),1),e("div",X,n(o.staff_id),1)]),e("td",Z,n(o.position),1),e("td",ee,n(o.department),1),e("td",te,[e("span",{class:f(["px-2 py-1 text-xs rounded-full border",o.work_status==="WFH"?"bg-blue-500/10 text-blue-300 border-blue-500/30":"bg-emerald-500/10 text-emerald-300 border-emerald-500/30"])},n(o.work_status),3)]),e("td",se,n(o.device),1),e("td",oe,n(k(o.report_day)),1),e("td",ae,n(o.status_code),1),e("td",ne,[e("button",{onClick:v=>w(o.id),class:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,re)])]))),128))])])])]))]),d.value.show?(l(),r("div",{key:0,class:f(["fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 px-4 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg z-50",d.value.type==="success"?"bg-green-600":"bg-red-600"])},[e("span",le,n(d.value.message),1)],2)):B("",!0)])])]))}};M(de).mount("#app");
