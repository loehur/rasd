import{r as c,c as s,o as l,p as T,a as t,d as p,w as C,n as h,t as a,u as $,F as w,l as y,g as E,h as P}from"./tailwind-PuH97mvQ.js";import{A as D}from"./api-n_PshMHp.js";import{_ as R}from"./AdminHeader-C0AWlkBv.js";const O={class:"min-h-screen bg-slate-950 text-slate-100"},J={class:"max-w-4xl mx-auto p-6"},U={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6 mb-6"},H={key:0,class:"w-16 h-16 mx-auto mb-4 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},K={key:1,class:"mb-4"},q={class:"text-lg font-semibold text-emerald-400"},G={class:"text-sm text-slate-400 mt-1"},Q={key:2},W={class:"mt-4 flex items-center justify-between"},X=["href"],Y={key:0,class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6 mb-6"},Z={class:"text-lg font-bold text-slate-100 mb-4"},ee={class:"overflow-x-auto"},te={class:"w-full text-sm border-collapse border border-slate-700 rounded-lg"},se={class:"bg-slate-800/50"},le={key:0,class:"text-xs text-slate-500 mt-2"},re={key:1,class:"flex gap-4"},oe=["disabled"],ae={key:0,class:"w-5 h-5 border-2 border-white/70 border-t-transparent rounded-full animate-spin"},ne={class:"flex items-start justify-between mb-3"},de={class:"flex items-center gap-2"},ie={key:0,class:"w-6 h-6 text-emerald-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ue={key:1,class:"w-6 h-6 text-red-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ce={key:0,class:"grid grid-cols-2 gap-3 mb-3"},pe={class:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-3"},ve={class:"text-2xl font-bold text-blue-300"},me={class:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-3"},xe={class:"text-2xl font-bold text-purple-300"},be={key:1,class:"mt-3"},fe={class:"bg-slate-950/50 rounded-lg p-3 max-h-40 overflow-y-auto"},he={class:"text-xs space-y-1"},ge={__name:"ImportTeamLeader",setup(ke){const i=c(null),g=c([]),v=c([]),_=c(!1),k=c(!1),u=c(""),n=c(!1),b=c([]),m=c(null),F=r=>{const e=r.target.files[0];e&&e.type==="text/csv"?(i.value=e,S(e)):alert("Please select a valid CSV file")},M=r=>{_.value=!1;const e=r.dataTransfer.files[0];e&&e.type==="text/csv"&&(i.value=e,S(e))},S=r=>{const e=new FileReader;e.onload=d=>{const o=d.target.result.split(`
`).filter(f=>f.trim());o.length>0&&(g.value=o[0].split(",").map(f=>f.trim()),v.value=o.slice(1).map(f=>{const z=f.split(","),B={};return g.value.forEach((A,N)=>{B[A]=z[N]?.trim()||""}),B}))},e.readAsText(r)},I=()=>{i.value=null,g.value=[],v.value=[],u.value="",m.value=null},V=()=>{u.value="",n.value=!1,b.value=[],m.value=null},j=r=>r<1024?r+" B":r<1048576?(r/1024).toFixed(2)+" KB":(r/1048576).toFixed(2)+" MB",L=async()=>{if(i.value){k.value=!0,u.value="",b.value=[];try{const r=localStorage.getItem("auth_token"),e=new FormData;e.append("file",i.value);const x=await(await fetch(`${D}/api/team-leaders/import`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:e})).text();let o;try{o=JSON.parse(x)}catch{n.value=!1,u.value="Server error: unexpected response (not JSON). Check console for details.",console.error("Import response (non-JSON):",x);return}o.success?(n.value=!0,u.value=o.message,b.value=o.data?.errors||[],m.value={imported:o.data?.imported||0,updated:o.data?.updated||0}):(n.value=!1,u.value=o.message||"Import failed. Please check your CSV format.",m.value=null)}catch(r){n.value=!1,u.value="Error: "+r.message}finally{k.value=!1}}};return(r,e)=>(l(),s("div",O,[T(R,{title:"Import Team Leader Data",subtitle:"Admin Portal"}),t("div",J,[t("div",U,[e[7]||(e[7]=t("h2",{class:"text-lg font-bold text-slate-100 mb-4"}," Upload CSV File ",-1)),t("div",{class:h(["border-2 border-dashed border-slate-700 rounded-xl p-8 text-center hover:border-blue-500/50 transition-all cursor-pointer",{"border-blue-500 bg-blue-500/5":_.value}]),onClick:e[0]||(e[0]=d=>r.$refs.fileInput.click()),onDragover:e[1]||(e[1]=C(d=>_.value=!0,["prevent"])),onDragleave:e[2]||(e[2]=d=>_.value=!1),onDrop:C(M,["prevent"])},[t("input",{ref:"fileInput",type:"file",accept:".csv",onChange:F,class:"hidden"},null,544),i.value?p("",!0):(l(),s("svg",H,[...e[3]||(e[3]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"},null,-1)])])),i.value?(l(),s("div",K,[e[4]||(e[4]=t("div",{class:"w-16 h-16 mx-auto mb-4 bg-emerald-500/20 rounded-xl flex items-center justify-center"},[t("svg",{class:"w-8 h-8 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("p",q,a(i.value.name),1),t("p",G,a(j(i.value.size))+" • "+a(v.value.length)+" rows detected ",1)])):(l(),s("div",Q,[...e[5]||(e[5]=[t("p",{class:"text-slate-400 mb-2"}," Click to upload or drag and drop ",-1),t("p",{class:"text-xs text-slate-500"}," CSV files only (max 2MB) ",-1)])])),i.value?(l(),s("button",{key:3,onClick:C(I,["stop"]),class:"mt-4 px-4 py-2 text-sm bg-red-600/20 text-red-400 border border-red-600/30 rounded-lg hover:bg-red-600/30 transition"}," Remove File ")):p("",!0)],34),t("div",W,[e[6]||(e[6]=t("p",{class:"text-sm text-slate-400"},"Don't have a CSV file?",-1)),t("a",{href:`${$(D)}/api/team-leaders/template`,download:"",class:"text-sm font-medium text-blue-400 hover:text-blue-300 underline"}," Download Template ",8,X)])]),v.value.length>0?(l(),s("div",Y,[t("h2",Z," Preview ("+a(v.value.length)+" rows) ",1),t("div",ee,[t("table",te,[t("thead",se,[t("tr",null,[(l(!0),s(w,null,y(g.value,d=>(l(),s("th",{key:d,class:"border border-slate-700 px-3 py-2 text-left text-xs font-semibold text-slate-300 uppercase"},a(d),1))),128))])]),t("tbody",null,[(l(!0),s(w,null,y(v.value.slice(0,5),(d,x)=>(l(),s("tr",{key:x,class:"hover:bg-slate-800/30"},[(l(!0),s(w,null,y(g.value,o=>(l(),s("td",{key:o,class:"border border-slate-700 px-3 py-2 text-slate-300"},a(d[o]||"-"),1))),128))]))),128))])])]),v.value.length>5?(l(),s("p",le," Showing first 5 of "+a(v.value.length)+" rows ",1)):p("",!0)])):p("",!0),i.value?(l(),s("div",re,[t("button",{onClick:L,disabled:k.value,class:"flex-1 py-3 px-6 bg-gradient-to-r from-blue-600 to-emerald-500 text-white font-semibold rounded-xl hover:from-blue-500 hover:to-emerald-400 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[k.value?(l(),s("span",ae)):p("",!0),t("span",null,a(k.value?"Importing...":"Import Team Leader Data"),1)],8,oe)])):p("",!0),u.value?(l(),s("div",{key:2,class:h(["mt-6 p-6 rounded-xl border",n.value?"bg-emerald-500/10 border-emerald-500/30":"bg-red-500/10 border-red-500/30"])},[t("div",ne,[t("div",de,[n.value?(l(),s("svg",ie,[...e[8]||(e[8]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(l(),s("svg",ue,[...e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])),t("p",{class:h(["font-bold text-lg",n.value?"text-emerald-300":"text-red-300"])},a(n.value?"Import Successful!":"Import Failed"),3)]),t("button",{onClick:V,class:"text-slate-400 hover:text-slate-200 transition"},[...e[10]||(e[10]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("p",{class:h(["mb-3",n.value?"text-emerald-200":"text-red-200"])},a(u.value),3),n.value&&m.value?(l(),s("div",ce,[t("div",pe,[e[11]||(e[11]=t("p",{class:"text-xs text-blue-300/70 mb-1"},"New Records",-1)),t("p",ve,a(m.value.imported),1)]),t("div",me,[e[12]||(e[12]=t("p",{class:"text-xs text-purple-300/70 mb-1"}," Updated Records ",-1)),t("p",xe,a(m.value.updated),1)])])):p("",!0),b.value.length>0?(l(),s("div",be,[t("p",{class:h(["text-sm font-semibold mb-2",n.value?"text-orange-300":"text-red-300"])},[e[13]||(e[13]=t("svg",{class:"w-4 h-4 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),E(" Errors ("+a(b.value.length)+"): ",1)],2),t("div",fe,[t("ul",he,[(l(!0),s(w,null,y(b.value,(d,x)=>(l(),s("li",{key:x,class:h([n.value?"text-orange-200":"text-red-200"])}," • "+a(d),3))),128))])])])):p("",!0)],2)):p("",!0)])]))}};P(ge).mount("#app");
