const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/api-Cer3rv52.js","assets/api-n_PshMHp.js"])))=>i.map(i=>d[i]);
import{r as g,i as N,j as $,c as i,o as d,a as e,d as _,g as R,t as h,w as j,e as E,v as A,F as C,l as P,n as B,h as T}from"./tailwind-Ddimza5B.js";import{A as k}from"./api-n_PshMHp.js";const I="modulepreload",O=function(y){return"/"+y},U={},D=function(c,v,b){let f=Promise.resolve();if(v&&v.length>0){let w=function(l){return Promise.all(l.map(p=>Promise.resolve(p).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),a=u?.nonce||u?.getAttribute("nonce");f=w(v.map(l=>{if(l=O(l),l in U)return;U[l]=!0;const p=l.endsWith(".css"),r=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${r}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":I,p||(m.as="script"),m.crossOrigin="",m.href=l,a&&m.setAttribute("nonce",a),document.head.appendChild(m),p)return new Promise((o,t)=>{m.addEventListener("load",o),m.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${l}`)))})}))}function x(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return f.then(u=>{for(const a of u||[])a.status==="rejected"&&x(a.reason);return c().catch(x)})},L={class:"min-h-screen bg-slate-950 text-slate-100"},M={class:"px-3 sm:px-6 lg:px-8 py-4"},V={class:"max-w-4xl mx-auto space-y-6"},z={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6"},J={class:"flex items-center justify-between mb-4"},q={class:"text-xs px-2 py-1 rounded bg-slate-800/60 border border-slate-700"},F={key:0,class:"p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-xl text-yellow-400"},X={key:1},G={class:"sm:col-span-2 flex justify-end"},H=["disabled"],W={class:"overflow-x-auto -mx-3 sm:mx-0 hidden md:block"},K={class:"min-w-full text-sm"},Q={class:"py-2 break-words px-3 sm:px-0"},Y={class:"py-2 break-words px-3 sm:px-0"},Z={class:"py-2"},ee={class:"py-2 flex items-center gap-2"},te=["onClick"],se=["onClick"],oe={class:"md:hidden space-y-3"},re={class:"flex items-center justify-between"},ae={class:"text-sm font-semibold text-slate-100"},le={class:"text-xs text-slate-400"},ne={class:"text-xs px-2 py-1 rounded bg-slate-700 text-slate-300"},ie={class:"mt-3 flex gap-2"},de=["onClick"],ce=["onClick"],ue={class:"text-white"},me={__name:"UsersPage",setup(y){const c=g({role:""}),v=g([]),b=g({name:"",phone_number:""}),f=g(!1),x=g({show:!1,message:"",type:"success"}),u=N(()=>v.value.filter(o=>!(o.role==="super-admin"||o.id===c.value.id)));$(async()=>{const o=localStorage.getItem("user");if(!o){window.location.href="/admin";return}c.value=JSON.parse(o),await a()});const a=async()=>{try{const o=localStorage.getItem("auth_token"),t=JSON.parse(localStorage.getItem("user")||"{}").role,n=await(await fetch(`${k}/api/users`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"X-Role":t}})).json();n.success&&(v.value=n.data)}catch(o){console.error("Load users error:",o)}},w=async()=>{f.value=!0;try{const o=localStorage.getItem("auth_token"),t=JSON.parse(localStorage.getItem("user")||"{}").role,n=await(await fetch(`${k}/api/users`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json","X-Role":t},body:JSON.stringify({name:b.value.name,phone_number:b.value.phone_number})})).json();n.success?(r("Admin user created"),b.value={name:"",phone_number:""},await a()):r(n.message||"Failed to create","error")}catch{r("Error creating user","error")}finally{f.value=!1}},l=async o=>{try{const t=localStorage.getItem("auth_token"),s=JSON.parse(localStorage.getItem("user")||"{}").role,S=await(await fetch(`${k}/api/users/${o}/reset-password`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"X-Role":s}})).json();S.success?r('Password reset to "Admin123!"'):r(S.message||"Reset failed","error")}catch{r("Error resetting password","error")}},p=async o=>{try{if(c.value.role!=="super-admin"){r("Forbidden","error");return}const{deleteUser:t}=await D(async()=>{const{deleteUser:n}=await import("./api-Cer3rv52.js");return{deleteUser:n}},__vite__mapDeps([0,1])),s=await t(o);s.success?(r("User deleted"),await a()):r(s.message||"Delete failed","error")}catch{r("Error deleting user","error")}},r=(o,t="success")=>{x.value={show:!0,message:o,type:t},setTimeout(()=>{x.value.show=!1},3e3)},m=()=>{window.location.href="/admin/dashboard"};return(o,t)=>(d(),i("div",L,[e("main",M,[e("div",V,[e("div",{class:"mb-4"},[e("button",{onClick:m,class:"text-slate-400 hover:text-slate-200 flex items-center gap-2 transition"},[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),R(" Back to Dashboard ",-1)])])]),e("div",z,[e("div",J,[t[3]||(t[3]=e("h2",{class:"text-xl font-bold"},"Manage Users",-1)),e("span",q,"Role: "+h(c.value.role),1)]),c.value.role!=="super-admin"?(d(),i("div",F," Hanya super-admin yang dapat mengakses halaman Users. ")):(d(),i("div",X,[e("form",{onSubmit:j(w,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6"},[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm text-slate-300 mb-2"},"Name *",-1)),E(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value.name=s),type:"text",required:"",class:"w-full px-3 sm:px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg"},null,512),[[A,b.value.name]])]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm text-slate-300 mb-2"},"Phone Number *",-1)),E(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value.phone_number=s),type:"text",required:"",class:"w-full px-3 sm:px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg"},null,512),[[A,b.value.phone_number]])]),e("div",G,[e("button",{disabled:f.value,class:"w-full sm:w-auto px-5 sm:px-6 py-2 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-white disabled:opacity-50"},h(f.value?"Saving...":"Add Admin"),9,H)])],32),e("div",W,[e("table",K,[t[6]||(t[6]=e("thead",null,[e("tr",{class:"text-left text-slate-300 border-b border-slate-800"},[e("th",{class:"py-2 px-3 sm:px-0"},"Name"),e("th",{class:"py-2 px-3 sm:px-0"},"Phone"),e("th",{class:"py-2"},"Role"),e("th",{class:"py-2"},"Actions")])],-1)),e("tbody",null,[(d(!0),i(C,null,P(u.value,s=>(d(),i("tr",{key:s.id,class:"border-b border-slate-800"},[e("td",Q,h(s.name),1),e("td",Y,h(s.phone_number),1),e("td",Z,h(s.role),1),e("td",ee,[s.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:0,onClick:n=>l(s.id),class:"w-full sm:w-auto px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 rounded text-white"}," Reset ",8,te)):_("",!0),s.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:1,onClick:n=>p(s.id),class:"w-full sm:w-auto px-3 py-1 text-sm bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,se)):_("",!0)])]))),128))])])]),e("div",oe,[(d(!0),i(C,null,P(u.value,s=>(d(),i("div",{key:s.id,class:"p-4 bg-slate-800/50 border border-slate-700 rounded-xl"},[e("div",re,[e("div",null,[e("p",ae,h(s.name),1),e("p",le,h(s.phone_number),1)]),e("span",ne,h(s.role),1)]),e("div",ie,[s.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:0,onClick:n=>l(s.id),class:"flex-1 px-3 py-2 text-xs bg-blue-600 hover:bg-blue-700 rounded text-white"}," Reset ",8,de)):_("",!0),s.role!=="super-admin"&&c.value.role==="super-admin"?(d(),i("button",{key:1,onClick:n=>p(s.id),class:"flex-1 px-3 py-2 text-xs bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,ce)):_("",!0)])]))),128))])]))]),x.value.show?(d(),i("div",{key:0,class:B(["fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 px-4 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg z-50",x.value.type==="success"?"bg-green-600":"bg-red-600"])},[e("span",ue,h(x.value.message),1)],2)):_("",!0)])])]))}};T(me).mount("#app");
