import{r as t,j as _,c as i,o as u,a as e,d as c,g as k,t as p,w as P,e as w,v as m,h as C}from"./tailwind--56Su58R.js";import{A as S}from"./api-COe7nS04.js";const B={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"},N={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},U={key:0,class:"mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded-lg flex items-start gap-3"},D={key:1,class:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700"},M={key:2,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700"},j={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},A={class:"flex justify-end"},E=["disabled"],I={__name:"ChangePasswordPage",setup(T){const f=t(""),v=t(!1),l=t(""),a=t(""),d=t(!1),g=t(!1),b=t({employee_id:"",name:""}),o=t({current_password:"",new_password:"",confirm_password:""});_(()=>{const n=localStorage.getItem("tl_auth_token"),s=localStorage.getItem("tl_user");if(!n||!s){window.location.href="/";return}const r=JSON.parse(s);b.value=r,f.value=r.name,g.value=localStorage.getItem("tl_must_change_password")==="true",document.addEventListener("click",x=>{x.target.closest(".relative")||(v.value=!1)})});const y=async()=>{if(l.value="",a.value="",o.value.new_password!==o.value.confirm_password){a.value="New passwords do not match";return}d.value=!0;try{const n=localStorage.getItem("tl_auth_token"),r=await(await fetch(`${S}/api/team-leader/account/password`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({current_password:o.value.current_password,new_password:o.value.new_password})})).json();r.success?(l.value="Password changed successfully!",localStorage.removeItem("tl_must_change_password"),o.value={current_password:"",new_password:"",confirm_password:""},setTimeout(()=>{window.location.href="/team-leader/dashboard"},2e3)):a.value=r.message||"Failed to change password"}catch(n){a.value="An error occurred. Please try again.",console.error("Error:",n)}finally{d.value=!1}},h=()=>{window.location.href="/team-leader/dashboard"};return(n,s)=>(u(),i("div",B,[e("main",N,[e("button",{onClick:h,class:"mb-6 flex items-center gap-2 text-indigo-600 hover:text-indigo-700 transition"},[...s[3]||(s[3]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),k(" Back to Dashboard ",-1)])]),s[9]||(s[9]=e("div",{class:"mb-8"},[e("h2",{class:"text-3xl font-bold text-gray-900"}," Change Password "),e("p",{class:"text-gray-600 mt-2"}," Update your password to keep your account secure ")],-1)),g.value?(u(),i("div",U,[...s[4]||(s[4]=[e("svg",{class:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),e("div",null,[e("p",{class:"text-sm font-semibold text-yellow-800"}," Default Password Detected "),e("p",{class:"text-sm text-yellow-700 mt-1"}," You are currently using the default password. For security reasons, you must change your password before you can access the dashboard and record attendance. ")],-1)])])):c("",!0),l.value?(u(),i("div",D,p(l.value),1)):c("",!0),a.value?(u(),i("div",M,p(a.value),1)):c("",!0),e("div",j,[s[8]||(s[8]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50"},[e("h3",{class:"text-xl font-bold text-gray-900"}," Update Password ")],-1)),e("form",{onSubmit:P(y,["prevent"]),class:"p-6 space-y-6"},[e("div",null,[s[5]||(s[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Current Password * ",-1)),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.value.current_password=r),type:"password",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter current password"},null,512),[[m,o.value.current_password]])]),e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," New Password * ",-1)),w(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>o.value.new_password=r),type:"password",required:"",minlength:"6",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter new password (min 6 characters)"},null,512),[[m,o.value.new_password]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Confirm New Password * ",-1)),w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.value.confirm_password=r),type:"password",required:"",minlength:"6",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Confirm new password"},null,512),[[m,o.value.confirm_password]])]),e("div",A,[e("button",{type:"submit",disabled:d.value,class:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition"},p(d.value?"Changing Password...":"Change Password"),9,E)])],32)])])]))}};C(I).mount("#app");
