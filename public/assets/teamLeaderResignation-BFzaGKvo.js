import{r as d,i as M,j as ae,c as r,o as n,a as e,d as $,g as j,n as C,t as l,F as V,l as T,w as re,e as g,k as R,v as L,b as q,h as ne}from"./tailwind-Cw3AK9J2.js";import{A as z}from"./api-rG_fphBW.js";const le={class:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-red-50 p-6"},ie={class:"max-w-7xl mx-auto"},de={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ue={class:"p-6"},pe={class:"bg-white shadow-sm border border-gray-200 rounded-xl p-4 mb-4"},ge={class:"flex flex-wrap gap-2"},ce={class:"ml-1 text-xs opacity-70"},me=["onClick"],fe={class:"ml-1 text-xs opacity-70"},ye={key:0,class:"text-center py-12"},ve={key:1,class:"text-center py-12"},xe={class:"text-gray-600"},be={key:2,class:"overflow-x-auto"},we={class:"min-w-full divide-y divide-gray-200"},he={class:"bg-white divide-y divide-gray-200"},_e={class:"px-6 py-4 whitespace-nowrap"},ke={class:"text-sm font-medium text-gray-900"},Se={class:"text-xs text-gray-500"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},je={class:"px-6 py-4 whitespace-nowrap"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Be=["title"],De={class:"mt-6 flex items-center justify-between"},Fe={class:"text-sm text-gray-600"},Ae={key:3,class:"text-center py-12"},Ve={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto"},Te={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full my-8"},Le={class:"p-6"},ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pe=["value"],Ue={class:"mt-4 space-y-4"},Ee={class:"text-xs text-gray-500 mt-1"},Ie={key:0,class:"flex items-center justify-center w-full"},Ne={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition"},Ye={key:1,class:"relative"},$e=["src"],qe={class:"flex gap-3 pt-6"},Oe=["disabled"],Ge={class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},He={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},Je={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},We={__name:"ResignationApp",setup(Ke){const x=d([]),_=d([]),B=d(!0),b=d(""),D=d(!1),k=d(!1),c=d({show:!1,message:"",type:"success"}),p=d(new Date().getFullYear()),P=d({total:0,per_page:15,current_page:1,last_page:1,from:0,to:0}),a=d({staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null,ranking_intervals:""}),m=d(null),O=M(()=>_.value.filter(s=>s.staff_status==="active"));ae(()=>{U(),E()});const U=async(s=1)=>{B.value=!0,b.value="";try{const t=localStorage.getItem("tl_auth_token"),o=new URLSearchParams;o.set("page",String(s));const u=await(await fetch(`${z}/api/resignations?${o.toString()}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json();u.success?(x.value=u.data||[],P.value=u.pagination):b.value=u.message||"Failed to load resignations"}catch(t){b.value="Failed to load resignations",console.error("Error:",t)}finally{B.value=!1}},E=async()=>{try{const s=localStorage.getItem("tl_auth_token"),o=await(await fetch(`${z}/api/attendances/staff/team-leader`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();o.success&&(_.value=o.data||[])}catch(s){console.error("Error fetching staff:",s)}},G=()=>{_.value.find(s=>s.staff_id===a.value.staff_id)},H=async s=>{const t=s.target.files[0];if(!t){a.value.proof=null,m.value=null;return}if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){w("Please upload only JPG or PNG images","error"),s.target.value="";return}try{const o=await J(t);a.value.proof=o;const i=new FileReader;i.onload=u=>{m.value=u.target.result},i.readAsDataURL(o)}catch(o){console.error("Error compressing image:",o),w("Failed to process image","error")}},J=async s=>new Promise((t,o)=>{const i=new FileReader;i.readAsDataURL(s),i.onload=u=>{const f=new Image;f.src=u.target.result,f.onload=()=>{const S=document.createElement("canvas");let y=f.width,v=f.height;if(y>1920||v>1920){const h=Math.min(1920/y,1920/v);y=Math.floor(y*h),v=Math.floor(v*h)}S.width=y,S.height=v,S.getContext("2d").drawImage(f,0,0,y,v);let A=.85;const Y=()=>{S.toBlob(h=>{if(h.size>2e5&&A>.1)A-=.05,Y();else{const se=new File([h],s.name,{type:"image/jpeg",lastModified:Date.now()});t(se)}},"image/jpeg",A)};Y()},f.onerror=o},i.onerror=o}),W=()=>{a.value.proof=null,m.value=null},K=()=>{D.value=!0},I=()=>{D.value=!1,X()},X=()=>{a.value={staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null,ranking_intervals:""},m.value=null},Q=async()=>{k.value=!0;try{const s=localStorage.getItem("tl_auth_token"),t=new FormData;t.append("staff_id",a.value.staff_id),t.append("last_working_day",a.value.last_working_day),t.append("resignation_type",a.value.resignation_type),t.append("resignation_subtype",a.value.resignation_subtype),t.append("report_day",a.value.report_day),t.append("reason",a.value.reason),t.append("ranking_intervals",a.value.ranking_intervals||""),a.value.proof&&t.append("proof",a.value.proof);const i=await(await fetch(`${z}/api/resignations`,{method:"POST",headers:{Authorization:`Bearer ${s}`},body:t})).json();i.success?(w(i.message||"Resignation recorded successfully","success"),I(),U(P.value.current_page),E()):w(i.message||"Operation failed","error")}catch(s){w("An error occurred: "+s.message,"error"),console.error("Error:",s)}finally{k.value=!1}},w=(s,t="success")=>{c.value={show:!0,message:s,type:t},setTimeout(()=>{c.value.show=!1},3e3)},N=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",Z=M(()=>{const s=new Set;return x.value.forEach(t=>{const o=t.report_day||t.last_working_day;if(!o)return;const i=new Date(o).getFullYear();isNaN(i)||s.add(i)}),Array.from(s).sort((t,o)=>o-t)}),ee=s=>x.value.filter(t=>{const o=t.report_day||t.last_working_day;return o&&new Date(o).getFullYear()===s}).length,te=M(()=>new Set(_.value.map(s=>s.staff_id))),F=M(()=>x.value.filter(s=>{if(!te.value.has(s.staff_id))return!1;if(!p.value||p.value==="")return!0;const t=s.report_day||s.last_working_day;return t?new Date(t).getFullYear()===p.value:!1})),oe=()=>{window.location.href="/team-leader/dashboard"};return(s,t)=>(n(),r("div",le,[e("div",ie,[e("div",{class:"mb-8"},[e("button",{onClick:oe,class:"mb-4 text-red-600 hover:text-red-800 flex items-center gap-2 transition"},[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),j(" Back to Dashboard ",-1)])]),t[9]||(t[9]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-red-600 via-orange-600 to-red-700"}," Staff Resignation ")])],-1))]),e("div",{class:"mb-6"},[e("button",{onClick:K,class:"px-6 py-3 bg-gradient-to-r from-red-600 to-orange-600 text-white font-semibold rounded-lg hover:from-red-700 hover:to-orange-700"},[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5 inline-block mr-2 -mt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Add Resignation Record ",-1)])])]),e("div",de,[t[18]||(t[18]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h2",{class:"text-xl font-bold text-gray-900"}," All Resignation Records ")],-1)),e("div",ue,[e("div",pe,[t[12]||(t[12]=e("div",{class:"flex items-center gap-2 mb-3"},[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),e("span",{class:"text-sm font-medium text-gray-700"},"Filter by Year:")],-1)),e("div",ge,[e("button",{onClick:t[0]||(t[0]=o=>p.value=""),class:C(["px-4 py-2 text-sm font-medium rounded-lg transition",p.value===""?"bg-gray-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[t[11]||(t[11]=j(" All Years ",-1)),e("span",ce,"("+l(x.value.length)+")",1)],2),(n(!0),r(V,null,T(Z.value,o=>(n(),r("button",{key:o,onClick:i=>p.value=o,class:C(["px-4 py-2 text-sm font-medium rounded-lg transition",p.value===o?"bg-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[j(l(o)+" ",1),e("span",fe,"("+l(ee(o))+")",1)],10,me))),128))])]),B.value?(n(),r("div",ye,[...t[13]||(t[13]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"},null,-1),e("p",{class:"mt-4 text-gray-600"}," Loading resignation records... ",-1)])])):b.value?(n(),r("div",ve,[t[14]||(t[14]=e("svg",{class:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",xe,l(b.value),1)])):F.value.length>0?(n(),r("div",be,[e("table",we,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Employee "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Last Working Day "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Type "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Subtype "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Report Day "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Reason "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," Status ")])],-1)),e("tbody",he,[(n(!0),r(V,null,T(F.value,o=>(n(),r("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",_e,[e("div",ke,l(o.staff_name),1),e("div",Se,l(o.staff_id),1)]),e("td",Me,l(N(o.last_working_day)),1),e("td",je,[e("span",{class:C(["px-2 py-1 text-xs font-semibold rounded-full",o.resignation_type==="voluntary"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"])},l(o.resignation_type),3)]),e("td",Ce,l(o.resignation_subtype),1),e("td",Re,l(N(o.report_day)),1),e("td",{class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 max-w-xs truncate",title:o.reason},l(o.reason||"-"),9,Be),t[15]||(t[15]=e("td",{class:"px-6 py-4 whitespace-nowrap"},[e("span",{class:"px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"}," Resign ")],-1))]))),128))])]),e("div",De,[e("p",Fe," Showing "+l(F.value.length)+" results ",1)])])):(n(),r("div",Ae,[...t[17]||(t[17]=[e("svg",{class:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-gray-600"}," No resignation records found ",-1)])]))])])]),D.value?(n(),r("div",Ve,[e("div",Te,[t[33]||(t[33]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h3",{class:"text-xl font-bold text-gray-900"}," Record Resignation ")],-1)),e("div",Le,[e("form",{onSubmit:re(Q,["prevent"])},[e("div",ze,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Employee *",-1)),g(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.staff_id=o),onChange:G,required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[t[19]||(t[19]=e("option",{value:""},"Select Employee",-1)),(n(!0),r(V,null,T(O.value,o=>(n(),r("option",{key:o.staff_id,value:o.staff_id},l(o.staff_id)+" - "+l(o.name),9,Pe))),128))],544),[[R,a.value.staff_id]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Last Working Day *",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.last_working_day=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[L,a.value.last_working_day]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type *",-1)),g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.resignation_type=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[22]||(t[22]=[e("option",{value:""},"Select Type",-1),e("option",{value:"voluntary"},"Voluntary",-1),e("option",{value:"involuntary"}," Involuntary ",-1)])],512),[[R,a.value.resignation_type]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Subtype *",-1)),g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.resignation_subtype=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[24]||(t[24]=[e("option",{value:""},"Select Subtype",-1),e("option",{value:"personal_reason"}," Personal Reason ",-1),e("option",{value:"management_reason"}," Management Reason ",-1)])],512),[[R,a.value.resignation_subtype]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Ranking/Intervals",-1)),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.ranking_intervals=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[26]||(t[26]=[q('<option value="">Select Ranking</option><option value="Top 5%">Top 5%</option><option value="5% ~ 25%">5% ~ 25%</option><option value="25% ~ 50%">25% ~ 50%</option><option value="50% ~ 70%">50% ~ 70%</option><option value="70% ~ 90%">70% ~ 90%</option><option value="Bottom 10%"> Bottom 10% </option>',7)])],512),[[R,a.value.ranking_intervals]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Report Day *",-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.report_day=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[L,a.value.report_day]])])]),e("div",Ue,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reason *",-1)),g(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=o=>a.value.reason=o),required:"",rows:"3",maxlength:"1000",placeholder:"Enter resignation reason...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 resize-none"},null,512),[[L,a.value.reason]]),e("p",Ee,l(a.value.reason.length)+"/1000 characters ",1)]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Proof (Optional)",-1)),m.value?(n(),r("div",Ye,[e("img",{src:m.value,class:"w-full h-48 object-cover rounded-lg border border-gray-300"},null,8,$e),e("button",{type:"button",onClick:W,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-2 hover:bg-red-700 transition"},[...t[31]||(t[31]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(n(),r("div",Ie,[e("label",Ne,[t[30]||(t[30]=q('<div class="flex flex-col items-center justify-center pt-5 pb-6"><svg class="w-8 h-8 mb-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><p class="mb-1 text-sm text-gray-500"><span class="font-semibold">Click to upload</span></p><p class="text-xs text-gray-500"> PNG or JPG (MAX. 10MB, will be compressed to 200KB) </p></div>',1)),e("input",{type:"file",class:"hidden",onChange:H,accept:"image/jpeg,image/jpg,image/png"},null,32)])]))])]),e("div",qe,[e("button",{type:"button",onClick:I,class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{type:"submit",disabled:k.value,class:"flex-1 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition"},l(k.value?"Submitting...":"Submit"),9,Oe)])],32)])])])):$("",!0),c.value.show?(n(),r("div",{key:1,class:C(["fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3",c.value.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"])},[(n(),r("svg",Ge,[c.value.type==="success"?(n(),r("path",He)):(n(),r("path",Je))])),e("span",null,l(c.value.message),1)],2)):$("",!0)]))}};ne(We).mount("#app");
