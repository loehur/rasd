import{r as d,i as Y,j as Z,c as a,o as n,a as e,d as I,g as U,e as g,v as j,t as l,F as z,l as E,n as $,w as ee,k as A,b as te,h as oe}from"./tailwind-DdHGqa1K.js";import{A as F}from"./api-n_PshMHp.js";const se={class:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-red-50 p-6"},re={class:"max-w-7xl mx-auto"},ae={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},ne={class:"p-6"},le={class:"mb-4 flex items-center gap-3"},ie={key:0,class:"text-center py-12"},de={key:1,class:"text-center py-12"},ue={class:"text-gray-600"},pe={key:2,class:"overflow-x-auto"},ge={class:"w-full text-sm"},ce={class:"px-4 py-3 text-red-600 font-mono"},fe={class:"px-4 py-3"},me={class:"px-4 py-3"},ye={class:"px-4 py-3"},ve={class:"px-4 py-3"},be={class:"px-4 py-3"},xe=["title"],he={class:"mt-6 flex items-center justify-between"},we={class:"text-sm text-gray-600"},_e={class:"flex gap-2"},ke=["disabled"],Se=["disabled"],je={key:3,class:"text-center py-12"},Me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto"},Ce={class:"bg-white rounded-xl shadow-xl max-w-2xl w-full my-8"},Re={class:"p-6"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Be=["value"],Ae={class:"mt-4 space-y-4"},Fe={class:"text-xs text-gray-500 mt-1"},Le={key:0,class:"flex items-center justify-center w-full"},Pe={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition"},Te={key:1,class:"relative"},Ve=["src"],Ie={class:"flex gap-3 pt-6"},Ue=["disabled"],ze={class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ee={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},$e={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"},Ne={__name:"ResignationApp",setup(qe){const M=d([]),C=d([]),R=d(!0),b=d(""),D=d(!1),_=d(!1),c=d({show:!1,message:"",type:"success"}),k=d(new Date().toISOString().split("T")[0]),u=d({total:0,per_page:15,current_page:1,last_page:1,from:0,to:0}),s=d({staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null}),f=d(null),N=Y(()=>C.value.filter(r=>r.staff_status==="active"));Z(()=>{x(),L()});const x=async(r=1)=>{R.value=!0,b.value="";try{const t=localStorage.getItem("tl_auth_token"),o=new URLSearchParams;o.set("page",String(r)),k.value&&o.set("report_day",k.value);const p=await(await fetch(`${F}/api/resignations?${o.toString()}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json();p.success?(M.value=p.data||[],u.value=p.pagination):b.value=p.message||"Failed to load resignations"}catch(t){b.value="Failed to load resignations",console.error("Error:",t)}finally{R.value=!1}},L=async()=>{try{const r=localStorage.getItem("tl_auth_token"),o=await(await fetch(`${F}/api/attendances/staff/team-leader`,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).json();o.success&&(C.value=o.data||[])}catch(r){console.error("Error fetching staff:",r)}},q=()=>{C.value.find(r=>r.staff_id===s.value.staff_id)},O=async r=>{const t=r.target.files[0];if(!t){s.value.proof=null,f.value=null;return}if(!["image/jpeg","image/jpg","image/png"].includes(t.type)){h("Please upload only JPG or PNG images","error"),r.target.value="";return}try{const o=await G(t);s.value.proof=o;const i=new FileReader;i.onload=p=>{f.value=p.target.result},i.readAsDataURL(o)}catch(o){console.error("Error compressing image:",o),h("Failed to process image","error")}},G=async r=>new Promise((t,o)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=p=>{const m=new Image;m.src=p.target.result,m.onload=()=>{const S=document.createElement("canvas");let y=m.width,v=m.height;if(y>1920||v>1920){const w=Math.min(1920/y,1920/v);y=Math.floor(y*w),v=Math.floor(v*w)}S.width=y,S.height=v,S.getContext("2d").drawImage(m,0,0,y,v);let B=.85;const V=()=>{S.toBlob(w=>{if(w.size>2e5&&B>.1)B-=.05,V();else{const Q=new File([w],r.name,{type:"image/jpeg",lastModified:Date.now()});t(Q)}},"image/jpeg",B)};V()},m.onerror=o},i.onerror=o}),H=()=>{s.value.proof=null,f.value=null},J=()=>{D.value=!0},P=()=>{D.value=!1,W()},W=()=>{s.value={staff_id:"",last_working_day:"",resignation_type:"",resignation_subtype:"",report_day:new Date().toISOString().split("T")[0],reason:"",proof:null},f.value=null},K=async()=>{_.value=!0;try{const r=localStorage.getItem("tl_auth_token"),t=new FormData;t.append("staff_id",s.value.staff_id),t.append("last_working_day",s.value.last_working_day),t.append("resignation_type",s.value.resignation_type),t.append("resignation_subtype",s.value.resignation_subtype),t.append("report_day",s.value.report_day),t.append("reason",s.value.reason),s.value.proof&&t.append("proof",s.value.proof);const i=await(await fetch(`${F}/api/resignations`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:t})).json();i.success?(h(i.message||"Resignation recorded successfully","success"),P(),x(u.value.current_page),L()):h(i.message||"Operation failed","error")}catch(r){h("An error occurred: "+r.message,"error"),console.error("Error:",r)}finally{_.value=!1}},h=(r,t="success")=>{c.value={show:!0,message:r,type:t},setTimeout(()=>{c.value.show=!1},3e3)},T=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-",X=()=>{window.location.href="/team-leader/dashboard"};return(r,t)=>(n(),a("div",se,[e("div",re,[e("div",{class:"mb-8"},[e("button",{onClick:X,class:"mb-4 text-red-600 hover:text-red-800 flex items-center gap-2 transition"},[...t[10]||(t[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),U(" Back to Dashboard ",-1)])]),t[11]||(t[11]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h1",{class:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-red-600 via-orange-600 to-red-700"}," Staff Resignation ")])],-1))]),e("div",{class:"mb-6"},[e("button",{onClick:J,class:"px-6 py-3 bg-gradient-to-r from-red-600 to-orange-600 text-white font-semibold rounded-lg hover:from-red-700 hover:to-orange-700"},[...t[12]||(t[12]=[e("svg",{class:"w-5 h-5 inline-block mr-2 -mt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),U(" Add Resignation Record ",-1)])])]),e("div",ae,[t[19]||(t[19]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h2",{class:"text-xl font-bold text-gray-900"}," All Resignation Records ")],-1)),e("div",ne,[e("div",le,[t[13]||(t[13]=e("label",{class:"text-sm font-medium text-gray-700"},"Filter tanggal (Report Day):",-1)),g(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>k.value=o),onChange:t[1]||(t[1]=o=>x(1)),class:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,544),[[j,k.value]])]),R.value?(n(),a("div",ie,[...t[14]||(t[14]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"},null,-1),e("p",{class:"mt-4 text-gray-600"}," Loading resignation records... ",-1)])])):b.value?(n(),a("div",de,[t[15]||(t[15]=e("svg",{class:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",ue,l(b.value),1)])):M.value.length>0?(n(),a("div",pe,[e("table",ge,[t[17]||(t[17]=e("thead",{class:"bg-gradient-to-r from-red-50 to-orange-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Staff ID "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Staff Name "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Last Working Day "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Type "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Subtype "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Report Day "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Reason "),e("th",{class:"px-4 py-3 text-left font-semibold text-gray-700"}," Status ")])],-1)),e("tbody",null,[(n(!0),a(z,null,E(M.value,o=>(n(),a("tr",{key:o.id,class:"border-t border-gray-200 hover:bg-red-50/50 transition"},[e("td",ce,l(o.staff_id),1),e("td",fe,l(o.staff_name),1),e("td",me,l(T(o.last_working_day)),1),e("td",ye,[e("span",{class:$(o.resignation_type==="voluntary"?"text-blue-600":"text-orange-600")},l(o.resignation_type),3)]),e("td",ve,l(o.resignation_subtype),1),e("td",be,l(T(o.report_day)),1),e("td",{class:"px-4 py-3 max-w-xs truncate",title:o.reason},l(o.reason||"-"),9,xe),t[16]||(t[16]=e("td",{class:"px-4 py-3"},[e("span",{class:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700"}," Inactive ")],-1))]))),128))])]),e("div",he,[e("p",we," Showing "+l(u.value.from)+" to "+l(u.value.to)+" of "+l(u.value.total)+" results ",1),e("div",_e,[e("button",{onClick:t[2]||(t[2]=o=>x(u.value.current_page-1)),disabled:u.value.current_page===1,class:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,ke),e("button",{onClick:t[3]||(t[3]=o=>x(u.value.current_page+1)),disabled:u.value.current_page===u.value.last_page,class:"px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,Se)])])])):(n(),a("div",je,[...t[18]||(t[18]=[e("svg",{class:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),e("p",{class:"text-gray-600"}," No resignation records found ",-1)])]))])])]),D.value?(n(),a("div",Me,[e("div",Ce,[t[32]||(t[32]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50"},[e("h3",{class:"text-xl font-bold text-gray-900"}," Record Resignation ")],-1)),e("div",Re,[e("form",{onSubmit:ee(K,["prevent"])},[e("div",De,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Employee *",-1)),g(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.staff_id=o),onChange:q,required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[t[20]||(t[20]=e("option",{value:""},"Select Employee",-1)),(n(!0),a(z,null,E(N.value,o=>(n(),a("option",{key:o.staff_id,value:o.staff_id},l(o.staff_id)+" - "+l(o.name),9,Be))),128))],544),[[A,s.value.staff_id]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Last Working Day *",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.last_working_day=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[j,s.value.last_working_day]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Type *",-1)),g(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.resignation_type=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[23]||(t[23]=[e("option",{value:""},"Select Type",-1),e("option",{value:"voluntary"},"Voluntary",-1),e("option",{value:"involuntary"}," Involuntary ",-1)])],512),[[A,s.value.resignation_type]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Subtype *",-1)),g(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.value.resignation_subtype=o),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},[...t[25]||(t[25]=[e("option",{value:""},"Select Subtype",-1),e("option",{value:"personal_reason"}," Personal Reason ",-1),e("option",{value:"management_reason"}," Management Reason ",-1)])],512),[[A,s.value.resignation_subtype]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Report Day *",-1)),g(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.value.report_day=o),type:"date",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500"},null,512),[[j,s.value.report_day]])])]),e("div",Ae,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reason *",-1)),g(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.value.reason=o),required:"",rows:"3",maxlength:"1000",placeholder:"Enter resignation reason...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 resize-none"},null,512),[[j,s.value.reason]]),e("p",Fe,l(s.value.reason.length)+"/1000 characters ",1)]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Proof (Optional)",-1)),f.value?(n(),a("div",Te,[e("img",{src:f.value,class:"w-full h-48 object-cover rounded-lg border border-gray-300"},null,8,Ve),e("button",{type:"button",onClick:H,class:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-2 hover:bg-red-700 transition"},[...t[30]||(t[30]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):(n(),a("div",Le,[e("label",Pe,[t[29]||(t[29]=te('<div class="flex flex-col items-center justify-center pt-5 pb-6"><svg class="w-8 h-8 mb-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg><p class="mb-1 text-sm text-gray-500"><span class="font-semibold">Click to upload</span></p><p class="text-xs text-gray-500"> PNG or JPG (MAX. 10MB, will be compressed to 200KB) </p></div>',1)),e("input",{type:"file",class:"hidden",onChange:O,accept:"image/jpeg,image/jpg,image/png"},null,32)])]))])]),e("div",Ie,[e("button",{type:"button",onClick:P,class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{type:"submit",disabled:_.value,class:"flex-1 px-4 py-2 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-lg hover:from-red-700 hover:to-orange-700 disabled:opacity-50 transition"},l(_.value?"Submitting...":"Submit"),9,Ue)])],32)])])])):I("",!0),c.value.show?(n(),a("div",{key:1,class:$(["fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-3",c.value.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"])},[(n(),a("svg",ze,[c.value.type==="success"?(n(),a("path",Ee)):(n(),a("path",$e))])),e("span",null,l(c.value.message),1)],2)):I("",!0)]))}};oe(Ne).mount("#app");
