import{r as t,j as P,c as n,o as d,a as e,t as i,d as m,w as h,b as M,g as x,e as w,v,h as B}from"./tailwind-BZyNWKWO.js";import{A as S}from"./api-n_PshMHp.js";const j={class:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"},N={class:"bg-white shadow-sm border-b border-gray-200"},D={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},A={class:"flex justify-between items-center"},I={class:"text-sm text-gray-600 mt-1"},U={class:"relative"},V={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},z={key:0,class:"mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded-lg flex items-start gap-3"},T={key:1,class:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700"},E={key:2,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700"},L={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},q={class:"flex justify-end"},F=["disabled"],$={__name:"ChangePasswordPage",setup(H){const g=t(""),u=t(!1),p=t(""),a=t(""),c=t(!1),b=t(!1),f=t({employee_id:"",name:""}),s=t({current_password:"",new_password:"",confirm_password:""});P(()=>{const l=localStorage.getItem("tl_auth_token"),o=localStorage.getItem("tl_user");if(!l||!o){window.location.href="/";return}const r=JSON.parse(o);f.value=r,g.value=r.name,b.value=localStorage.getItem("tl_must_change_password")==="true",document.addEventListener("click",C=>{C.target.closest(".relative")||(u.value=!1)})});const y=async()=>{if(p.value="",a.value="",s.value.new_password!==s.value.confirm_password){a.value="New passwords do not match";return}c.value=!0;try{const l=localStorage.getItem("tl_auth_token"),r=await(await fetch(`${S}/api/team-leader/account/password`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({current_password:s.value.current_password,new_password:s.value.new_password})})).json();r.success?(p.value="Password changed successfully!",localStorage.removeItem("tl_must_change_password"),s.value={current_password:"",new_password:"",confirm_password:""},setTimeout(()=>{window.location.href="/team-leader/dashboard"},2e3)):a.value=r.message||"Failed to change password"}catch(l){a.value="An error occurred. Please try again.",console.error("Error:",l)}finally{c.value=!1}},k=()=>{window.location.href="/team-leader/dashboard"},_=()=>{localStorage.removeItem("tl_auth_token"),localStorage.removeItem("tl_user"),window.location.href="/"};return(l,o)=>(d(),n("div",j,[e("header",N,[e("div",D,[e("div",A,[e("div",null,[o[5]||(o[5]=e("h1",{class:"text-2xl font-bold text-gray-900"},"TL-Dashboard",-1)),e("p",I,"Welcome, "+i(g.value),1)]),e("div",U,[e("button",{onClick:o[0]||(o[0]=r=>u.value=!u.value),class:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"},[o[6]||(o[6]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("span",null,i(g.value),1),o[7]||(o[7]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),u.value?(d(),n("div",{key:0,onClick:o[1]||(o[1]=h(()=>{},["stop"])),class:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50"},[o[9]||(o[9]=M('<a href="/team-leader/dashboard" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition"><svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg> Dashboard </a><a href="/team-leader/account" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition"><svg class="w-4 h-4 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Account </a><div class="border-t border-gray-200 my-1"></div>',3)),e("button",{onClick:_,class:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition"},[...o[8]||(o[8]=[e("svg",{class:"w-4 h-4 inline-block mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1),x(" Logout ",-1)])])])):m("",!0)])])])]),e("main",V,[e("button",{onClick:k,class:"mb-6 flex items-center gap-2 text-indigo-600 hover:text-indigo-700 transition"},[...o[10]||(o[10]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),x(" Back to Dashboard ",-1)])]),o[16]||(o[16]=e("div",{class:"mb-8"},[e("h2",{class:"text-3xl font-bold text-gray-900"},"Change Password"),e("p",{class:"text-gray-600 mt-2"},"Update your password to keep your account secure")],-1)),b.value?(d(),n("div",z,[...o[11]||(o[11]=[e("svg",{class:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),e("div",null,[e("p",{class:"text-sm font-semibold text-yellow-800"},"Default Password Detected"),e("p",{class:"text-sm text-yellow-700 mt-1"}," You are currently using the default password. For security reasons, you must change your password before you can access the dashboard and record attendance. ")],-1)])])):m("",!0),p.value?(d(),n("div",T,i(p.value),1)):m("",!0),a.value?(d(),n("div",E,i(a.value),1)):m("",!0),e("div",L,[o[15]||(o[15]=e("div",{class:"p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50"},[e("h3",{class:"text-xl font-bold text-gray-900"},"Update Password")],-1)),e("form",{onSubmit:h(y,["prevent"]),class:"p-6 space-y-6"},[e("div",null,[o[12]||(o[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Current Password * ",-1)),w(e("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>s.value.current_password=r),type:"password",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter current password"},null,512),[[v,s.value.current_password]])]),e("div",null,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," New Password * ",-1)),w(e("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>s.value.new_password=r),type:"password",required:"",minlength:"6",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Enter new password (min 6 characters)"},null,512),[[v,s.value.new_password]])]),e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Confirm New Password * ",-1)),w(e("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>s.value.confirm_password=r),type:"password",required:"",minlength:"6",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Confirm new password"},null,512),[[v,s.value.confirm_password]])]),e("div",q,[e("button",{type:"submit",disabled:c.value,class:"px-6 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 transition"},i(c.value?"Changing Password...":"Change Password"),9,F)])],32)])])]))}};B($).mount("#app");
