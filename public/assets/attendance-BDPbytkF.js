import{r as _,j as E,c as r,o as l,p as F,a as e,d as $,e as U,v as j,F as B,l as N,t as n,n as w,h as P}from"./tailwind-ChUXPuL2.js";import{_ as M}from"./AdminHeader-4-4_YIjN.js";import{adminGetAttendancesByMonth as H,adminDeleteAttendance as O}from"./api-Cb4adFKZ.js";import{A as V}from"./api-DjxYVOX3.js";const W={class:"min-h-screen bg-slate-950 text-slate-100"},z={class:"px-3 sm:px-6 lg:px-8 py-4"},I={class:"max-w-6xl mx-auto space-y-6"},T={class:"bg-slate-900/70 backdrop-blur border border-slate-800/80 rounded-2xl p-6"},G={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"},Y={class:"flex items-center gap-3"},q={key:0,class:"p-6 text-slate-300"},J={key:1},K={class:"overflow-x-auto -mx-3 sm:mx-0"},Q={class:"min-w-full text-sm"},X={class:"py-2 px-3 sm:px-0"},Z={class:"font-medium text-slate-100"},ee={class:"text-xs text-slate-400"},te={class:"py-2"},se={class:"py-2"},oe={class:"py-2"},ae={class:"py-2"},ne={class:"py-2"},re={class:"py-2"},le={class:"py-2"},ce=["onClick"],de={class:"text-white"},ie={__name:"AttendancePage",setup(pe){const h=_(!1),x=_([]),u=_(`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}`),c=_({show:!1,message:"",type:"success"});E(async()=>{await y()});const y=async()=>{try{h.value=!0;const a=await H(u.value,1e3);a.success?x.value=a.data||[]:d(a.message||"Failed to load attendances","error")}catch{d("Error loading attendances","error")}finally{h.value=!1}},D=async a=>{try{const s=await O(a);s.success?(d("Attendance deleted"),await y()):d(s.message||"Delete failed","error")}catch{d("Error deleting attendance","error")}},k=a=>new Date(a).toLocaleDateString(),d=(a,s="success")=>{c.value={show:!0,message:a,type:s},setTimeout(()=>{c.value.show=!1},3e3)},S=()=>{const s=[["SN","Status","WFH/Oniste","ID Staff","Name Staff","Position","Superior","Department","Hiredate","Rank","Device","Report Date","Ranking Intervals","Group","Reason for resign","Proof"],...x.value.map((t,p)=>{const m=t.proof||"",R=String(V||"").replace(/\/$/,""),v=m.startsWith("/")?m.slice(1):m,L=/^https?:\/\//i.test(m)?m:v?`${R}/${v}`:"",g=t.team_leader||t.teamLeader,C=t.superior||g&&g.name||"";return[p+1,t.status_code||"",t.work_status||"",t.staff_id||"",t.name||"",t.position||"",C,t.department||"",t.hire_date?new Date(t.hire_date).toLocaleDateString():"",t.rank||"",t.device||"",t.report_day?new Date(t.report_day).toLocaleDateString():"",t.ranking_intervals||"",t.group||"",t.reason_for_resign||"",L]})],o=t=>{const p=String(t??"");return/[",\n]/.test(p)?'"'+p.replace(/"/g,'""')+'"':p},b=s.map(t=>t.map(o).join(",")).join(`
`),A=new Blob([b],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(A),i=document.createElement("a");i.href=f,i.download=`attendance_${u.value}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(f)};return(a,s)=>(l(),r("div",W,[F(M,{title:"Attendance Records",subtitle:"Admin Portal"}),e("main",z,[e("div",I,[e("div",T,[e("div",G,[s[2]||(s[2]=e("h2",{class:"text-lg sm:text-xl font-bold"}," Attendance Records ",-1)),e("div",Y,[s[1]||(s[1]=e("label",{class:"text-sm text-slate-300"},"Filter bulan:",-1)),U(e("input",{type:"month","onUpdate:modelValue":s[0]||(s[0]=o=>u.value=o),onChange:y,class:"px-3 py-2 bg-slate-800/50 border border-slate-700 rounded text-slate-100"},null,544),[[j,u.value]]),e("button",{onClick:S,class:"px-3 py-2 bg-emerald-600 hover:bg-emerald-700 rounded text-white"}," Export ")])]),h.value?(l(),r("div",q," Loading... ")):(l(),r("div",J,[e("div",K,[e("table",Q,[s[3]||(s[3]=e("thead",null,[e("tr",{class:"text-left text-slate-300 border-b border-slate-800"},[e("th",{class:"py-2 px-3 sm:px-0"}," Employee "),e("th",{class:"py-2"},"Position"),e("th",{class:"py-2"},"Department"),e("th",{class:"py-2"},"WFH/Onsite"),e("th",{class:"py-2"},"Device"),e("th",{class:"py-2"},"Report Day"),e("th",{class:"py-2"},"Status"),e("th",{class:"py-2"},"Actions")])],-1)),e("tbody",null,[(l(!0),r(B,null,N(x.value,o=>(l(),r("tr",{key:o.id,class:"border-b border-slate-800"},[e("td",X,[e("div",Z,n(o.name),1),e("div",ee,n(o.staff_id),1)]),e("td",te,n(o.position),1),e("td",se,n(o.department),1),e("td",oe,[e("span",{class:w(["px-2 py-1 text-xs rounded-full border",o.work_status==="WFH"?"bg-blue-500/10 text-blue-300 border-blue-500/30":"bg-emerald-500/10 text-emerald-300 border-emerald-500/30"])},n(o.work_status),3)]),e("td",ae,n(o.device),1),e("td",ne,n(k(o.report_day)),1),e("td",re,n(o.status_code),1),e("td",le,[e("button",{onClick:b=>D(o.id),class:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 rounded text-white"}," Delete ",8,ce)])]))),128))])])])]))]),c.value.show?(l(),r("div",{key:0,class:w(["fixed top-4 left-1/2 -translate-x-1/2 sm:left-auto sm:translate-x-0 sm:right-4 px-4 sm:px-6 py-3 sm:py-4 rounded-lg shadow-lg z-50",c.value.type==="success"?"bg-green-600":"bg-red-600"])},[e("span",de,n(c.value.message),1)],2)):$("",!0)])])]))}};P(ie).mount("#app");
